{"version":3,"sources":["../../src/sprites/player.js"],"names":["UP","LEFT","DOWN","RIGHT","NONE","Pacman","KEY","PlayerSprite","Player","constructor","game","map","position","direction","eaten","due","lives","score","resetPlayerPosition","addScore","nScore","getScore","loseLife","getLives","initLevel","newLevel","x","y","reset","move","npos","nextWhole","oldPosition","block","getNewCoord","isOnSamePlane","onGridSquare","isFloor","next","isWall","new","old","getBlock","isMidSquare","COOKIE","PILL","setBlock","EMPTY","completedLevel","eatenPill"],"mappings":"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","file":"player.js","sourcesContent":["import {\n  UP,\n  LEFT,\n  DOWN,\n  RIGHT,\n  NONE,\n  Pacman,\n  KEY,\n} from '../constants.js';\n\nimport PlayerSprite from './playerSprite';\n\nexport default class Player extends PlayerSprite {\n\n  constructor(game, map) {\n    super(game, map);\n    this.position = null;\n    this.direction = null;\n    this.eaten = null;\n    this.due = null;\n    this.lives = null;\n    this.score = 5;\n    this.resetPlayerPosition();\n  }\n\n  addScore(nScore) {\n    this.score += nScore;\n    if (this.score >= 10000 && this.score - nScore < 10000) {\n      this.lives += 1;\n    }\n  }\n\n  getScore() {\n    return this.score;\n  }\n\n  loseLife() {\n    this.lives -= 1;\n  }\n\n  getLives() {\n    return this.lives;\n  }\n\n  initLevel() {\n    this.score = 0;\n    this.lives = 3;\n    this.newLevel();\n  }\n\n  newLevel() {\n    this.resetPlayerPosition();\n    this.eaten = 0;\n  }\n\n  resetPlayerPosition() {\n    this.position = {\n      x: 90,\n      y: 120,\n    };\n    this.direction = LEFT;\n    this.due = LEFT;\n  }\n\n  reset() {\n    this.initLevel();\n    this.resetPlayerPosition();\n  }\n\n  move() {\n    let npos = null;\n    let nextWhole = null;\n    const oldPosition = this.position;\n    let block = null;\n\n    if (this.due !== this.direction) {\n      npos = this.getNewCoord(this.due, this.position);\n\n      if (this.isOnSamePlane(this.due, this.direction)\n        || this.onGridSquare(this.position)\n        && this.map.isFloor(this.next(npos, this.due))) {\n        this.direction = this.due;\n      } else {\n        npos = null;\n      }\n    }\n\n    if (npos === null) {\n      npos = this.getNewCoord(this.direction, this.position);\n    }\n\n    if (this.onGridSquare(this.position)\n        && this.map.isWall(this.next(npos, this.direction))) {\n      this.direction = NONE;\n    }\n\n    if (this.direction === NONE) {\n      return {\n        new: this.position,\n        old: this.position,\n      };\n    }\n\n    if (npos.y === 100 && npos.x >= 190 && this.direction === RIGHT) {\n      npos = {\n        y: 100,\n        x: -10,\n      };\n    }\n\n    if (npos.y === 100 && npos.x <= -12 && this.direction === LEFT) {\n      npos = {\n        y: 100,\n        x: 190,\n      };\n    }\n\n    this.position = npos;\n    nextWhole = this.next(this.position, this.direction);\n\n    block = this.map.getBlock(nextWhole);\n\n    if ((this.isMidSquare(this.position.y) || this.isMidSquare(this.position.x))\n    && block === Pacman.COOKIE || block === Pacman.PILL) {\n\n      this.map.setBlock(nextWhole, Pacman.EMPTY);\n      this.addScore(block === Pacman.COOKIE ?\n       10 :\n       50);\n      this.eaten += 1;\n\n      if (this.eaten === 182) {\n        this.game.completedLevel();\n      }\n\n      if (block === Pacman.PILL) {\n        this.game.eatenPill();\n      }\n    }\n\n    return {\n      new: this.position,\n      old: oldPosition\n    };\n  }\n}\n"]}